<script>
  async function fetchLevelFromGPT(score) {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "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" // ← 여기에 GPT API 키 넣기 (주의: 노출X)
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [
          {
            role: "system",
            content: "너는 수학 선생님이야. 학생의 진단 점수를 바탕으로 수준(A~E)과 설명을 알려줘."
          },
          {
            role: "user",
            content: `학생의 진단평가 점수는 ${score}점이야. 이 학생의 수학 수준(A~E)과 간단한 설명을 한국어로 알려줘.`
          }
        ],
        temperature: 0.7
      })
    });

    const data = await response.json();
    const reply = data.choices[0].message.content;
    // 예: "수준: B\n설명: 수학적 개념을 어느 정도 이해하고 있으며 적용 능력도 보입니다."

    const levelMatch = reply.match(/수준:\s*([A-E])/);
    const descriptionMatch = reply.match(/설명:\s*(.+)/);

    const level = levelMatch ? levelMatch[1] : "정보 없음";
    const description = descriptionMatch ? descriptionMatch[1] : "분석 실패";

    // 화면에 표시
    document.getElementById("level").innerText = `수준: ${level}`;
    document.getElementById("description").innerText = description;

    // localStorage에도 저장
    localStorage.setItem("level", level);
    localStorage.setItem("description", description);
  }

  // 예: 점수를 localStorage에서 가져와 GPT에 분석 요청
  const score = localStorage.getItem("score");
  if (score) {
    fetchLevelFromGPT(score);
  } else {
    document.getElementById("level").innerText = "결과를 찾을 수 없습니다.";
    document.getElementById("description").innerText = "진단평가를 먼저 진행해 주세요.";
  }
</script>
